# This workflow will install Python dependencies, run tests and lint with a single version of Python
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-python

name: Python application

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

permissions:
  contents: read

jobs:
  build:

    #runs-on: ubuntu-latest
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v3
    - name: Set up Python 3.10
      uses: actions/setup-python@v3
      with:
        python-version: "3.10"
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install flake8 pytest
        pip install aiohttp
        pip install asyncio
        pip install bs4
        pip install ftplib
        pip install PIL
        pip install pyinstaller
        pip install pyppeteer
        pip install pyuac
        pip install pywin32
        pip install questionary
        pip install tqdm
        pip install webbrowser
        pip install win32api
        pip install winshell

        
        
        if (Test-Path requirements.txt) {pip install -r requirements.txt}
      shell: pwsh

    # - name: Lint with flake8
    #   run: |
    #     # stop the build if there are Python syntax errors or undefined names
    #     flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
    #     # exit-zero treats all errors as warnings. The GitHub editor is 127 chars wide
    #     flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics
    # - name: Test with pytest
    #   run: |
    #     pytest
    - name: Create Executable
      run: pyinstaller --onefile --hidden-import=PIL main.py

    - name: Upload Executable
      uses: actions/upload-artifact@v2
      with:
        name: main.exe
        path: dist/main.exe
